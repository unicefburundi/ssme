{% extends "base_layout.html" %}
{% load extras_utils2  %}
{% block page_title %}
<h5><i class="glyphicon glyphicon-list-alt"> </i> {{ object.name|  capfirst }} CDS</h5>
{% endblock page_title %}

{% block content %}
{% if object %}
    <div class="row">
        <div class="col-md-3">
            <dl class="dl-horizontal">
                <dt>Name of the CDS : </dt>
                <p> {{object.name}}</p>
                <dt>Code of the CDS : </dt>
                <p> {{object.code}}</p>
                <dt>Pop total attendue: </dt>
                <p id="pop_total"> {{pop_total.population_cible}}</p>
                <dt>District : </dt>
                <p> {{object.district}}</p>
                <dt>Province : </dt>
                <p> {{object.district.province.name}}</p>
            </dl>
        </div>
        <div class="col-md-8">
            <ul class="nav nav-tabs">
                <div class="page-header">
                  <h3>Rapports au CDS : {{ object.name|  capfirst }}</h3>
                </div>
                  <li {% block activebeneficiary %}class="active"{% endblock activebeneficiary %} >
                    <a href="#beneficiary"   data-toggle="tab">Beneficiaires</a>
                  </li>
                  <li {% block activereception %}{% endblock activereception %} >
                    <a href="#reception"   data-toggle="tab">Received Stock</a>
                  </li>
                  <li {% block activefinal %}{% endblock activefinal %} >
                    <a href="#final"   data-toggle="tab">Final Stock</a>
                  </li>
                  {% if user.is_staff %}
                    <li {% block activeestimation %}{% endblock activeestimation %} >
                      <a href="#estimation"   data-toggle="tab">Estimation Beneficiares</a>
                    </li>
                {% endif %}
            </ul>
            <div class="tab-content">
              <div class="tab-pane {% block activebeneficiary1 %}active{% endblock activebeneficiary1 %}" id="beneficiary">
                <h5><i class="glyphicon glyphicon-comment"></i> {{mycampaign|default:"The Beginning"}} du {{mycampaign.start_date}} au {{mycampaign.end_date}}</h5>
                {% block beneficiary %}
                    <div class="col-md-11">
                      <table class="table table-bordered" data-toggle="table"  data-show-export="true" data-search="true" data-export-types=['csv','excel'] data-show-footer="true">
                        <thead>
                          <tr>
                            <th data-footer-formatter="totalTextFormatter">Date</th>
                            {% for header in headers_benef %}
                              <th data-footer-formatter="benefFormatter">{{header.beneficiaires}}</th>
                            {% endfor %}
                          </tr>
                        </thead>
                        <tbody>
                          {% for i in body_benef  %}
                            <tr>
                            <td>{{i.reception_date}}</td>
                            {% for t in headers_benef  %}
                              <td>{{i|getit:t.beneficiaires}}</td>
                            {% endfor %}
                          </tr>
                          {% endfor %}
                        </tbody>

                      </table>
                    </div>
                    <div class="col-md-1"></div>
                {% endblock beneficiary %}
              </div>
              <div class="tab-pane {% block activereception1 %}{% endblock activereception1 %}" id="reception">
                <h5><i class="glyphicon glyphicon-cog"></i> {{mycampaign|default:"The Beginning"}} du {{mycampaign.start_date}} au {{mycampaign.end_date}}</h5>
                {% block reception %}
                    <div class="col-md-11">
                      <table class="table table-bordered" data-toggle="table"  data-show-export="true" data-search="true" data-export-types=['csv','excel'] data-show-footer="true">
                        <thead>
                          <tr>
                            <th data-footer-formatter="totalTextFormatter">Date</th>
                            {% for header in headers_recept %}
                              <th data-footer-formatter="sumFormatter">{{header.products}}</th>
                            {% endfor %}
                          </tr>
                        </thead>
                        <tbody>
                          {% for i in body_reception  %}
                            <tr>
                            <td>{{i.reception_date}}</td>
                            {% for t in headers_recept  %}
                              <td>{{i|getit:t.products}}</td>
                            {% endfor %}
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                    <div class="col-md-1"></div>
                {% endblock reception %}
              </div>
              <div class="tab-pane {% block activefinal1 %}{% endblock activefinal1 %}" id="final">
                <h5><i class="glyphicon glyphicon-list-alt"></i> {{mycampaign|default:"The Beginning"}} du {{mycampaign.start_date}} au {{mycampaign.end_date}}</h5>
                {% block final %}
                    <div class="col-md-11">
                      <table class="table table-bordered" data-toggle="table"  data-show-export="true" data-search="true" data-export-types=['csv','excel'] data-show-footer="true">
                        <thead>
                          <tr>
                            <th data-footer-formatter="consumptionTextFormatter">Date</th>
                            {% for header in headers_recept %}
                              <th >{{header.products}}</th>
                            {% endfor %}
                          </tr>
                        </thead>
                        <tbody>
                          {% for i in body_remain  %}
                            <tr>
                            <td>{{i.concerned_date}}</td>
                            {% for t in headers_recept  %}
                              <td>{{i|getit:t.products}}</td>
                            {% endfor %}
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                    <div class="col-md-1"></div>
                {% endblock final %}
              </div>
              <div class="tab-pane {% block activeestimation1 %}{% endblock activeestimation1 %}" id="estimation">
                <h5><i class="glyphicon glyphicon-list-alt"></i> {{mycampaign|default:"The Beginning"}} du {{mycampaign.start_date|date:"d M, Y"}} au {{mycampaign.end_date|date:"d M, Y"}}</h5>
                {% block estimation %}
                    <div class="col-md-12">
                    <table class="table table-bordered" data-toggle="table"  data-show-export="true" data-search="true" data-export-types=['csv','excel'] data-show-footer="true">
                        <thead>
                          <tr>
                            <th data-footer-formatter="receivedTextFormatter">Beneficiaires</th>
                            {% for header in headers_recept %}
                              <th data-footer-formatter="receivedFormatter">{{header.products}}</th>
                            {% endfor %}
                          </tr>
                        </thead>
                        <tbody>
                          {% for i in estimation  %}
                            <tr>
                            <td>{{i.beneficiaires}}</td>
                            {% for t in headers_recept  %}
                                <td>{{i|get_item:t.products|default:0}} </td>
                            {% endfor %}
                          </tr>
                          {% endfor %}
                        </tbody>
                    </table>
                    </div>
                {% endblock estimation %}
              </div>
            </div>
        </div>
        <div class="col-md-1">

        </div>
    </div>

{% else %}
No Patient in this CDS
{% endif %}
<script>
function receivedTextFormatter(data) {
          return '<strong class="text-primary" >SR - Tot/prod</strong>';
      };

  function receivedFormatter(data) {
        var recus = "{{recus|safe}}";
        recus = eval( "(" + recus + ")" );
        var total = 0;
        field = this.field;
        $.each(data, function (i, row) {
              total += +(row[field]);
          });
        diff =  recus[this.title] - total;
        if (diff <0) {
          return  '<strong class="text-danger" >' + diff + '</strong>';
        }
        else{
          return  '<strong class="text-primary" >' + diff + '</strong>';
        };

      }
</script>
{% endblock content %}